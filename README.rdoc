= mta-sms

== DESCRIPTION

mta-sms is an HTTP server with a Twilio SMS endpoint that looks up MTA Metro-North Railroad timetables.

== SYNOPSIS

Run the server with <tt>rackup</tt>

  ONLINE=true bundle exec rackup

== ROUTES

=== <tt>POST /search/twilio</tt>

This endpoint is a webhook for Twilio incoming messages
(https://www.twilio.com/docs/sms/twiml). Right now, this endpoint only inspects
the <tt>Body</tt> parameter. The message body should contain two Metro-North station
names separated by a non-alphanumeric character. For example, this cURL command
line is well-formed:

  curl localhost/search/twilio --data 'Body=ludlow / spuyten duyvil'

This endpoint does some basic fuzzy searching of the station names given on
this MTA Web page: http://as0.mta.info/mnr/schedules/sched_form.cfm, so you
could do something like <tt>'Body=ludl / spn dvl'</tt>.

== ENVIRONMENT

  ONLINE
    if truthy, use the real MTA Web site to scrape timetables. else, use a
    dummy timetable

== WHY

I use a phone that only has voice, SMS and bad MMS. The MTA has a rich SMS
interface for the bus system at http://bustime.mta.info/wiki/Help/SMSSearching,
but it doesn't seem to have one for anything else.

This code scrapes HTML pages. I tried to find a GTFS API, but even with an MTA
developer account I haven't been able to access any Metro-North data.

== TODO

- make fuzzy station searching real, ie. maybe use something a little better than the <tt>did_you_mean</tt> gem

- add error handling for malformed messages or for when the MTA Web site is down

- rate limit by phone number

- add a "favorites" feature so you don't have to type over and over again, ideally you could say, "inbound" or "outbound" and get your desired station pairs

- allow searching arbitrary times in the future

- use a programmatic API instead of scraping HTML
